<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>IRC Client Demo</title>

	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link rel="stylesheet" href="./main.css" />

	<link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" />

	<script type="module" src="./script.js" defer></script>
</head>
<body>

	<!-- iconset octicons -->
	<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">

		<symbol id="x-circle" viewBox="0 0 16 16" fill="currentColor">
			<title>Circled closing X</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M3.404 12.596a6.5 6.5 0 119.192-9.192 6.5 6.5 0 01-9.192 9.192zM2.344 2.343a8 8 0 1011.313 11.314A8 8 0 002.343 2.343zM6.03 4.97a.75.75 0 00-1.06 1.06L6.94 8 4.97 9.97a.75.75 0 101.06 1.06L8 9.06l1.97 1.97a.75.75 0 101.06-1.06L9.06 8l1.97-1.97a.75.75 0 10-1.06-1.06L8 6.94 6.03 4.97z"/>
		</symbol>

		<symbol id="dot" viewBox="0 0 16 16" fill="currentColor">
			<title>Ring</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M8 5.5a2.5 2.5 0 100 5 2.5 2.5 0 000-5zM4 8a4 4 0 118 0 4 4 0 01-8 0z"/>
		</symbol>

		<symbol id="dot-fill" viewBox="0 0 16 16" fill="currentColor">
			<title>Dot</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8z"/>
		</symbol>

		<symbol id="arrow-switch" viewBox="0 0 16 16" fill="currentColor">
			<title>Back and forward arrows</title>
			<desc></desc>
			<path d="M5.22 14.78a.75.75 0 001.06-1.06L4.56 12h8.69a.75.75 0 000-1.5H4.56l1.72-1.72a.75.75 0 00-1.06-1.06l-3 3a.75.75 0 000 1.06l3 3zm5.56-6.5a.75.75 0 11-1.06-1.06l1.72-1.72H2.75a.75.75 0 010-1.5h8.69L9.72 2.28a.75.75 0 011.06-1.06l3 3a.75.75 0 010 1.06l-3 3z"/>
		</symbol>

		<symbol id="verified" viewBox="0 0 16 16" fill="currentColor">
			<title>Verified checkmark</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M9.585.52a2.678 2.678 0 00-3.17 0l-.928.68a1.178 1.178 0 01-.518.215L3.83 1.59a2.678 2.678 0 00-2.24 2.24l-.175 1.14a1.178 1.178 0 01-.215.518l-.68.928a2.678 2.678 0 000 3.17l.68.928c.113.153.186.33.215.518l.175 1.138a2.678 2.678 0 002.24 2.24l1.138.175c.187.029.365.102.518.215l.928.68a2.678 2.678 0 003.17 0l.928-.68a1.17 1.17 0 01.518-.215l1.138-.175a2.678 2.678 0 002.241-2.241l.175-1.138c.029-.187.102-.365.215-.518l.68-.928a2.678 2.678 0 000-3.17l-.68-.928a1.179 1.179 0 01-.215-.518L14.41 3.83a2.678 2.678 0 00-2.24-2.24l-1.138-.175a1.179 1.179 0 01-.518-.215L9.585.52zM7.303 1.728c.415-.305.98-.305 1.394 0l.928.68c.348.256.752.423 1.18.489l1.136.174c.51.078.909.478.987.987l.174 1.137c.066.427.233.831.489 1.18l.68.927c.305.415.305.98 0 1.394l-.68.928a2.678 2.678 0 00-.489 1.18l-.174 1.136a1.178 1.178 0 01-.987.987l-1.137.174a2.678 2.678 0 00-1.18.489l-.927.68c-.415.305-.98.305-1.394 0l-.928-.68a2.678 2.678 0 00-1.18-.489l-1.136-.174a1.178 1.178 0 01-.987-.987l-.174-1.137a2.678 2.678 0 00-.489-1.18l-.68-.927a1.178 1.178 0 010-1.394l.68-.928c.256-.348.423-.752.489-1.18l.174-1.136c.078-.51.478-.909.987-.987l1.137-.174a2.678 2.678 0 001.18-.489l.927-.68zM11.28 6.78a.75.75 0 00-1.06-1.06L7 8.94 5.78 7.72a.75.75 0 00-1.06 1.06l1.75 1.75a.75.75 0 001.06 0l3.75-3.75z"/>
		</symbol>

		<symbol id="sync" viewBox="0 0 16 16" fill="currentColor">
			<title>Sync arrows</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M8 2.5a5.487 5.487 0 00-4.131 1.869l1.204 1.204A.25.25 0 014.896 6H1.25A.25.25 0 011 5.75V2.104a.25.25 0 01.427-.177l1.38 1.38A7.001 7.001 0 0114.95 7.16a.75.75 0 11-1.49.178A5.501 5.501 0 008 2.5zM1.705 8.005a.75.75 0 01.834.656 5.501 5.501 0 009.592 2.97l-1.204-1.204a.25.25 0 01.177-.427h3.646a.25.25 0 01.25.25v3.646a.25.25 0 01-.427.177l-1.38-1.38A7.001 7.001 0 011.05 8.84a.75.75 0 01.656-.834z"/>
		</symbol>

		<symbol id="visible" viewBox="0 0 16 16" fill="currentColor">
			<title>Visible</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"/>
		</symbol>

		<symbol id="invisible" viewBox="0 0 16 16" fill="currentColor">
			<title>Invisible</title>
			<desc></desc>
			<path fill-rule="evenodd" d="M.143 2.31a.75.75 0 011.047-.167l14.5 10.5a.75.75 0 11-.88 1.214l-2.248-1.628C11.346 13.19 9.792 14 8 14c-1.981 0-3.67-.992-4.933-2.078C1.797 10.832.88 9.577.43 8.9a1.618 1.618 0 010-1.797c.353-.533.995-1.42 1.868-2.305L.31 3.357A.75.75 0 01.143 2.31zm3.386 3.378a14.21 14.21 0 00-1.85 2.244.12.12 0 00-.022.068c0 .021.006.045.022.068.412.621 1.242 1.75 2.366 2.717C5.175 11.758 6.527 12.5 8 12.5c1.195 0 2.31-.488 3.29-1.191L9.063 9.695A2 2 0 016.058 7.52l-2.53-1.832zM8 3.5c-.516 0-1.017.09-1.499.251a.75.75 0 11-.473-1.423A6.23 6.23 0 018 2c1.981 0 3.67.992 4.933 2.078 1.27 1.091 2.187 2.345 2.637 3.023a1.619 1.619 0 010 1.798c-.11.166-.248.365-.41.587a.75.75 0 11-1.21-.887c.148-.201.272-.382.371-.53a.119.119 0 000-.137c-.412-.621-1.242-1.75-2.366-2.717C10.825 4.242 9.473 3.5 8 3.5z"/>
		</symbol>
	</svg>

	<div id="app">
		<div id="server">
			<form>
				<p class="input">
					<label for="server-url">Server URL
						<svg id="connection-indicator" class="icon" v-bind:class="connected ? 'on' : 'off'" v-bind:title="connected ? 'Connected' : 'Disconnected'"><use v-if="connected" xlink:href="#dot-fill" /><use v-if="!connected" xlink:href="#dot" /></svg>
					</label>
					<input type="text" id="server-url" placeholder="irc.unrealircd.org" v-model="url" v-bind:readonly="connected" required />
				</p>
				<p class="input">
					<label for="server-port">WSS Port</label>
					<input type="number" id="server-port" placeholder="443" v-model="port" v-bind:readonly="connected" required />
				</p>

				<button class="primary" v-on:click.prevent="toggleConnection">{{ connected ? 'Disconnect' : 'Connect' }}</button>
			</form>
		</div>
		<div id="channels">
			<h2 v-on:click="visible = !visible">Available Channels <svg class="icon visible" v-if="visible"><use xlink:href="#visible" /></svg><svg class="icon invisible" v-if="!visible"><use xlink:href="#invisible" /></svg></h2>
			<div v-if="visible">
				<ul class="list">
					<li v-if="channels.length < 1">No active channels</li>
					<li v-for="channel in channels">
						<a v-bind:href="channel" v-on:click.prevent="join($event,channel)">{{ channel }}</a>
					</li>
				</ul>
				<nav>
					<a id="refresh-channels" href="#refresh" class="button secondary" v-on:click.prevent="refresh">
						<svg class="icon"><use xlink:href="#sync" /></svg>
					</a>
				</nav>
			</div>
		</div>
		<div id="chats">
			<div id="messages" ref="root">
				<h2 v-on:click="visible = !visible">Connected channels <svg class="icon visible" v-if="visible"><use xlink:href="#visible" /></svg><svg class="icon invisible" v-if="!visible"><use xlink:href="#invisible" /></svg></h2>
				<nav class="tab-navigation" v-if="visible">
					<ul>
						<li v-for="tab in tabs" v-bind:class="(tab.active) ? 'active' : ''">
							<a v-bind:href="tab.title" v-on:click.prevent="activate(tab.title)">{{ tab.title }}&nbsp;<svg class="icon close" v-if="tab.title != 'server'" v-on:click="closeTab(tab.title)"><use xlink:href="#x-circle" /></svg></a>
						</li>
					</ul>
				</nav>
				<ul class="tab-content" v-if="visible">
					<li v-for="tab in tabs" v-bind:data-title="tab.title" v-bind:class="(tab.active) ? 'active' : ''">
						<ul class="users">
							<li v-for="user in tab.users"><a href="#dm" v-on:click.prevent="newDM(user)" title="Send a private message to this user"><svg v-if="user.startsWith('@')" class="icon discussion"><use xlink:href="#verified" /></svg> {{ user.replace('@', '') }}</a></li>
						</ul>
						<ul class="messages">
							<li v-for="msg in tab.messages" v-bind:class="[(msg.command == 'ERROR') ? 'error' : '', msgType(msg)]">
								<time v-bind:datetime="formatDatetime(msg.tags.time)">{{ formatDatetime(msg.tags.time, 'short') }}</time>
								<span class="prefix">{{ (msg.prefix) ? ((!msg.prefix.isServer) ? msg.prefix.nick : (msg.prefix.host) ? msg.prefix.host : 'Server') : 'Server' }}</span>
								<span class="command" v-bind:title="msg.commandString ? msg.commandString : ''" v-bind:class="(tab.title != 'server' && msg.command.toUpperCase() == 'PRIVMSG') ? 'hidden' : ''">{{ msg.command }}</span>
								<span class="target" v-bind:class="(tab.title != 'server' && msg.command.toUpperCase() == 'PRIVMSG') ? 'hidden' : ''">{{ msg.params[0] }}</span>
								<span class="params" v-html="autoLink(msg.params.slice(1).join(' '))"></span>
							</li>
						</ul>
					</li>
				</ul>
			</div>

			<form id="input" v-if="visible">
				<input type="text" id="msg" placeholder="your message" autocomplete="off" v-model="input" v-on:keyup="keyUp($event)" ref="msgField" />
				<input type="submit" value="Send" v-on:click.prevent="send" />
			</form>

			<div class="help" v-if="visible">
				<h2 v-on:click="showHelp = !showHelp">Help <svg class="icon visible" v-if="showHelp"><use xlink:href="#visible" /></svg><svg class="icon invisible" v-if="!showHelp"><use xlink:href="#invisible" /></svg></h2>
				<div class="help-content" v-if="showHelp">
					<h3>Commands</h3>
			
					<dl>
						<dt>/JOIN #&lt;channel&gt;</dt><dd>Join or create a channel</dd>
						<dt>/PART #&lt;channel&gt;</dt><dd>Leave a channel</dd>
						<dt>/MSG &lt;target&gt; :message</dt><dd>Send a message. Target can be a #channel or a @user</dd>
						<dt>/NICK &lt;nickname&gt;</dt><dd>Change your nickname</dd>
						<dt>/WHOIS &lt;nickname&gt;</dt><dd>Get info on a user by their nickname</dd>
						<dt>/MODE #&lt;channel&gt; +o &lt;nickname&gt;</dt><dd>Give a user channel moderator privileges</dd>
					</dl>

					<p><a href="https://gist.github.com/xero/2d6e4b061b4ecbeb9f99">Detailed help</a></p>
				</div>
			</div>
		</div>
		<div id="userdata">
			<h2 v-on:click="visible = !visible">User data <svg class="icon visible" v-if="visible"><use xlink:href="#visible" /></svg><svg class="icon invisible" v-if="!visible"><use xlink:href="#invisible" /></svg></h2>
			<form v-if="visible">
				<p class="input"><label for="user-name">username</label><input type="text" id="user-name" placeholder="your username" v-model="username" v-bind:readonly="lockInput" required /></p>
				<p class="input"><label for="user-realname">real name</label><input type="text" id="user-realname" placeholder="your real name" v-model="realname" v-bind:readonly="lockInput" required /></p>
				<p class="input"><label for="user-nick">nickname</label><input type="text" id="user-nick" placeholder="your nickname" v-model="nick" required /></p>
				<p class="input"><input type="submit" value="Save" v-on:click.prevent="updateNick" class="secondary" /></p>
				<p>For changes to username or real name to happen, you need to disconnect from the IRC server.</p>
				<button v-on:click.prevent="toggleTheme" class="secondary">Color Theme</button>
			</form>
		</div>
		<div id="dm" ref="root">
			<h2 v-on:click="visible = !visible">Direct Messages <svg class="icon visible" v-if="visible"><use xlink:href="#visible" /></svg><svg class="icon invisible" v-if="!visible"><use xlink:href="#invisible" /></svg> <span class="unread-count" v-if="unreadMessages > 0">{{ unreadMessages }}</span></h2>
			<!-- direct messages -->
			<ul class="conversations" v-if="visible">
				<li v-for="conv in conversations" v-bind:class="(conv.active) ? 'active' : ''" v-bind:id="'dm-'+conv.title">
					<h3><svg class="icon discussion"><use xlink:href="#arrow-switch" /></svg> <a v-bind:href="conv.title" v-on:click.prevent="showConversation(conv.title)">{{ conv.title }} <span class="unread-count" v-if="conv.unread > 0">{{ conv.unread }}</span></a></h3>

					<ul class="messages">
						<li v-for="msg in conv.messages" v-bind:class="(msg.prefix.nick !== conv.title) ? 'self' : 'them'" v-bind:title="formatDatetime(msg.tags.time, 'short')">
							<time v-bind:datetime="formatDatetime(msg.tags.time)">{{ formatDatetime(msg.tags.time, 'short') }}</time>
							<span class="prefix">{{ msg.prefix.nick }}</span>
							<span class="command">{{ msg.command }}</span>
							<span class="target">{{ msg.params[0] }}</span>
							<span class="params">{{ msg.params[1] }}</span>
						</li>
					</ul>

					<form class="input" v-bind:id="'dm-'+conv.title+'-input'" v-on:submit.prevent="sendDM(conv.title, conv.input, $event)">
						<input type="text" id="msg" placeholder="your message" autocomplete="off" v-model="conv.input" v-bind:maxlength="512 - conv.title.length - 'PRIVMSG'.length - 2" />
						<input type="submit" value="Send" />
					</form>
				</li>
			</ul>
		</div>
	</div>

	<div id="connection">{{ ws ? ws.readyState : '' }}</div>
	<div id="demo">

		<ul>
			<li v-for="tab in tabs">
				<h2>{{ tab === '0' ? 'status' : tab }}</h2>
				<ul>
					<li v-for="msg in getChannel(tab)">{{ msg.raw }}</li>
				</ul>
			</li>
		</ul>

		<ul>
			<li v-for="tab2 in dms">
				<h2>{{ tab2 }}</h2>
				<ul>
					<li v-for="msg2 in getChannel(tab2)">{{ msg2.raw }}</li>
				</ul>
			</li>
		</ul>
	</div>
</body>
</html>